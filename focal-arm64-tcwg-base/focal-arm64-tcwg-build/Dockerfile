# Auto generated by ./tcwg-base/generate-dockerfiles.sh from tcwg-base/tcwg-build/Dockerfile.in. Do not edit.
FROM linaro/ci-arm64-tcwg-base-ubuntu:focal
RUN while read line; do \
      if [ x"$(echo "$line" | cut -d: -f 4)" != x"9000" ]; then \
        continue; \
      fi; \
      new-user.sh --passwd "$line"; \
      user=$(echo "$line" | cut -d: -f 1); \
      sudo -i -u $user ccache -p; \
    done </home-data/passwd
# We create ccache directory as tcwg-buildslave, because otherwise
# "docker run -v ccache-volume:/home/tcwg-buildslave/.ccache" will create
# it owned by root:root, which will break builds.  We set ccache size:
# - 50G is a bare minimum to ccache the gnu/llvm builds
# - The aa64/amd64 build machines have enough disk to support 50G
# - TK1s have small disk, so try to get by with 10G.
RUN sudo -i -u tcwg-buildslave mkdir -p /home/tcwg-buildslave/.ccache \
 && sudo -i -u tcwg-buildslave ccache -M 50G
# Add llvm 11 to get llvm-objdump with support for --disassemble-symbols.
# We need this in bmk-scripts.git/symbol_md5sum.sh.
RUN \
 apt-get update \
 && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
 llvm-11 \
 && apt-get clean \
 && rm -rf \
 /var/lib/apt/lists/* \
 /tmp/* \
 /var/tmp/* \
 # This will override llvm-objdump installed by tcwg-base's llvm package.
 && ln -s `which llvm-objdump-11` /usr/local/bin/llvm-objdump
# checksum: f4581c2c071379c5b031871727887448
