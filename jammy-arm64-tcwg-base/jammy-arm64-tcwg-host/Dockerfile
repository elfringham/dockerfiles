# Auto generated by ./tcwg-base/generate-dockerfiles.sh from tcwg-base/tcwg-host/Dockerfile.in. Do not edit.
FROM linaro/ci-arm64-tcwg-base-ubuntu:jammy
# Add the latest clang (14.0.5)
RUN \
 clang_ver=clang+llvm-14.0.5-aarch64-linux-gnu \
 && cd /usr/local \
 && wget --progress=dot:giga https://github.com/llvm/llvm-project/releases/download/llvmorg-14.0.5/$clang_ver.tar.xz \
 && tar xf $clang_ver.tar.xz \
 && rm $clang_ver.tar.xz
# Add libpgmath, which is used by flang
RUN git clone https://github.com/rovka/libpgmath-binaries.git \
 && mv libpgmath-binaries/* /usr/local/lib/ \
 && rm -rf libpgmath-binaries
# Add cmake 3.24, which has support for flang
RUN wget https://github.com/Kitware/CMake/releases/download/v3.24.0-rc4/cmake-3.24.0-rc4-linux-aarch64.sh \
 && chmod +x cmake-3.24.0-rc4-linux-aarch64.sh \
 && ./cmake-3.24.0-rc4-linux-aarch64.sh --prefix=/usr/local --skip-license
COPY docker-stats docker-wrapper tcwg-build.sh /usr/local/bin/
COPY docker-wrapper /usr/local/bin/docker
COPY run.sh start.sh /
# Allow privileged containers to access services on the bare machine.
# See run_on_bare_machine and run.sh for details.
COPY run_on_bare_machine /usr/local/bin/
RUN ln -sf /usr/local/bin/run_on_bare_machine /usr/sbin/sysctl \
 && ln -sf /usr/local/bin/run_on_bare_machine /usr/bin/systemctl \
 && ln -sf /usr/local/bin/run_on_bare_machine /usr/bin/timedatectl \
 && ln -sf /usr/local/bin/run_on_bare_machine /usr/sbin/reboot
# These are compatibility links for prepare-board.sh to find cpupower in the same
# place when running "start_board" on bare machine and inside host container.
# These are for TK1s and TX1s.
RUN true \
 && ln -s /usr/lib/linux-tools/4.18.0-13-generic /usr/lib/linux-tools/3.10.40 \
 && ln -s /usr/lib/linux-tools/4.18.0-13-generic /usr/lib/linux-tools/4.4.38-tegra
ENV TINI_VERSION v0.18.0
ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini-arm64 /sbin/tini
RUN chmod +x /sbin/tini
ENTRYPOINT ["/sbin/tini", "--", "/run.sh"]
CMD ["start.sh"]
# checksum: 6455d1dd5a8d12cf264a8cb329d9c384
