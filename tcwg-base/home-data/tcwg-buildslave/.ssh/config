# === BEGIN: TCWG SSH configuration ===
#
# !!! THIS MUST BE COPIED TO THE START OF YOUR ~/.SSH/CONFIG FILE. !!!
# !!! IF YOU REPORT A PROBLEM WITH SSH, AND THIS CONFIGURATION IS NOT !!!
# !!! AT THE START OF YOUR FILE -- YOU HAVE OBVIOUSLY MISSED THIS VERY !!!
# !!! IMPORTANT NOTE. AS PENANCE, YOU WILL READ THIS NOTE OUT LOUD. !!!
#

Host *.tcwglab people.linaro.org lab.validation.linaro.org
 #User @LDAP_USER@
 #IdentityFile ~/.ssh/id_rsa

# Proxy connections to custom ssh servers (inside containers) on firewalled
# hosts through "main" ssh server on that host.
# E.g., "ssh -p32768 proxy.dev-01.tcwglab"
Host *proxy.*
 ProxyCommand ssh $(echo %h | sed -e "s/proxy\.//") nc -q0 localhost %p

# Access to Cambridge Lab.  E.g., ssh dev-01.tcwglab
Host *.tcwglab
 ProxyCommand ~/.ssh/ssh-tcwglab-nc.sh -q0 %h %p

# Access to LAVA Lab.  E.g., "ssh root@10.7.0.18.lab"
Host *.lab
 ProxyCommand ssh lab.validation.linaro.org nc -q0 $(basename %h .lab) %p

# We store logs on bkp-01.tcwglab and scripts can hang for 5 minutes
# before exiting due to ssh master hanging in the background.
# Since we don't connect to bkp-01.tcwglab much, we disable connection sharing.
Host bkp-01.tcwglab
 ControlPath none

Host *.tcwglab *.lab tcwg-d05-01 libgomp-d05 tcwg-lc-01 tcwg-thx1-01
 # Enable automatic multiplexing.
 ControlMaster auto
 # Soften up potential problems with killing master connection by using
 # ControlPersist (which puts the master connection in background).
 # Also ControlPersist has an undocumented feature that it will clean-up
 # and replace stale ssh socket from a zombie connection.
 ControlPersist 5m
 # Put the ssh socket on /tmp.  Note that overlayfs can't host sockets,
 # so we always arrange /tmp to be on a ext4 or equivalent FS.
 ControlPath /tmp/ssh-%u-%r@%h:%p
 # Forward authentication agent and keep private keys in one place.
 ForwardAgent yes
 # Disable checking of host keys for boards behind gateways.
 # !!! BE BECAREFUL TO ONLY DO THIS FOR MACHINES BEHIND SSH GATEWAY OR VPN !!!
 StrictHostKeyChecking no
 # Don't store host keys for one-time containers
 UserKnownHostsFile /dev/null
 # Don't warn about "adding" host keys to /dev/null
 LogLevel FATAL

Host ci.linaro.org
 Port 2020

Host git*.linaro.org dev-private-git.linaro.org
 User git

Host bkp-01.tcwglab build-09.tcwglab build-10.tcwglab llvm-tk1-*.tcwglab tcwg-llvmbot-*.tcwglab tcwg-d05-01 libgomp-d05 tcwg-lc-01 tcwg-thx1-01 tcwg-sq-*.tcwglab tcwg-tk1-10.tcwglab
 # SSH server in "jenkins" container runs on 2022, and in "host" -- on 2222.
 Port 2022

Host tcwg-d05-01 libgomp-d05
 Hostname 147.75.106.138

Host tcwg-lc-01
 Hostname 213.146.141.115

Host tcwg-thx1-01
 Hostname 147.75.77.198

Host tcwg-ex40-01 ex40-01
 Hostname ex40-01.tcwglab.linaro.org

Host *
 # There is little point in forwarding X11 to machines outside of local network.
 ForwardX11 no
 # Ping server every 5min to avoid routers dropping connection.
 # This matches -o BatchMode=yes setting used in cross-testing (see ABE)
 ServerAliveInterval 300
# === END: TCWG SSH configuration ===
