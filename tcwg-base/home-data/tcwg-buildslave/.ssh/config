# === BEGIN: TCWG SSH configuration ===
#
# This must be copied to the start of your ~/.ssh/config file.
# Ssh uses the first matching occurence for a setting, so the farther
# this is from the top, the more likely it is that some other stanza
# will take precendence.
#

# Include local changes (e.g., users can define port numbers of their
# dev containers).  Requires openssh-server from Ubuntu 18.04 or later,
# so can't enable by default for now.
#Include ~/.ssh/config.d/*

Host tcwg-* *.tcwglab linaro-armv8-01 libgomp-d05 people.linaro.org lab.validation.linaro.org ci.linaro.org
 #User @LDAP_USER@
 #IdentityFile ~/.ssh/id_rsa

# Access to Cambridge Lab.  E.g., ssh dev-01.tcwglab
Host *.tcwglab
 ProxyCommand ~/.ssh/ssh-tcwglab-nc.sh -q0 %h %p

# We store logs on bkp-01.tcwglab and scripts can hang for 5 minutes
# before exiting due to ssh master hanging in the background.
# Since we don't connect to bkp-01.tcwglab much, we disable connection sharing.
Host bkp-01.tcwglab
 ControlPath none

Host tcwg-* *.tcwglab linaro-armv8-01 libgomp-d05
 # Forward authentication agent and keep private keys in one place.
 ForwardAgent yes
 # Enable automatic multiplexing.
 ControlMaster auto
 # Soften up potential problems with killing master connection by using
 # ControlPersist (which puts the master connection in background).
 # Also ControlPersist has an undocumented feature that it will clean-up
 # and replace stale ssh socket from a zombie connection.
 ControlPersist 5m
 # Put the ssh socket on /tmp.  Note that overlayfs can't host sockets,
 # so we always arrange /tmp to be on a ext4 or equivalent FS.
 ControlPath /tmp/ssh-%u-%r@%h:%p

Host *.tcwglab
 # Disable checking of host keys for boards behind gateways.
 # !!! BE BECAREFUL TO ONLY DO THIS FOR MACHINES BEHIND SSH GATEWAY OR VPN !!!
 StrictHostKeyChecking no
 # Don't store host keys for one-time containers
 UserKnownHostsFile /dev/null
 # Don't warn about "adding" host keys to /dev/null
 LogLevel FATAL

Host ci.linaro.org
 Port 2020

Host git*.linaro.org dev-private-git.linaro.org
 User git

# Connect to "host" container to all but benchmarking boards
Host tcwg-tk1-10.tcwglab
 Port 2222
Host tcwg-tk1-*.tcwglab tcwg-tx1-*.tcwglab
 Port 22
Host tcwg-* *.tcwglab linaro-armv8-01 libgomp-d05
 Port 2222

Host linaro-armv8-01
 Hostname 147.75.199.202

Host tcwg-amp-01
 Hostname 147.75.55.170

Host tcwg-amp-02
 Hostname 139.178.86.246

Host tcwg-amp-03
 Hostname 139.178.82.90

Host tcwg-amp-04
 Hostname 139.178.85.170

Host tcwg-d05-01 libgomp-d05
 Hostname 147.75.106.138

Host tcwg-m1-01
 Hostname 213.146.141.80

Host tcwg-m1-02
 Hostname 213.146.141.115

Host tcwg-m1-03
 Hostname 213.146.141.96

Host tcwg-m1-04
 Hostname 213.146.141.34

Host tcwg-thx1-01
 Hostname 147.75.77.198

Host tcwg-ex40-01 ex40-01
 Hostname ex40-01.tcwglab.linaro.org

Host *
 # There is little point in forwarding X11 to machines outside of local network.
 ForwardX11 no
 # Ping server every 5min to avoid routers dropping connection.
 # This matches -o BatchMode=yes setting used in cross-testing (see ABE)
 ServerAliveInterval 300
# === END: TCWG SSH configuration ===
